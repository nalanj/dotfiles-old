#!/bin/bash
set -e

if [[ "$#" -ne 2 ]]; then
    echo "Usage git pr [name] [commit]"
    exit
fi

name="pr/$1"
refspec=$2

orig_head=$(git rev-parse --abbrev-ref HEAD)
changes=$(git status -s | wc -l)

if [[ $changes -gt 0 ]]; then
  echo "You have pending changes"
  exit
fi

echo "* Creating PR branch $name"
git branch $name origin/master --no-track
git checkout -q $name

echo "* Applying $refspec"
git cherry-pick $refspec

echo "* Back to $orig_head"
git checkout -q $orig_head
