#!/bin/bash

# Adds the given rev to the given PR

set -e

if [[ "$#" -ne 2 ]]; then
    echo "Usage: git pr-add [name] [rev]"
    exit
fi

name="pr/$1"
rev=$2

orig_head=$(git rev-parse --abbrev-ref HEAD)
changes=$(git status -s | wc -l)

if [[ $changes -gt 0 ]]; then
  echo "You have pending changes"
  exit
fi

echo "* Checkout out $rev"
git checkout -q $name

echo "* Applying $rev"
git cherry-pick $rev

echo "* Back to $orig_head"
git checkout -q $orig_head

